<div class="catalog-page">
  <div class="page-header">
    <div>
      <h1>Ofertas Disponibles</h1>
      <p class="text-muted">Explora e inscr√≠bete en las materias disponibles</p>
    </div>
    <!-- Finalize Enrollment Button -->
    <button 
      class="btn btn-finalize"
      *ngIf="enrollmentPeriodOpen && !enrollmentFinalized"
      [disabled]="finalizing"
      (click)="finalizeEnrollment()">
      {{ finalizing ? 'Finalizando...' : 'üîí Finalizar Inscripci√≥n' }}
    </button>
  </div>

  <!-- Enrollment Finalized Banner -->
  <div class="finalized-banner" *ngIf="enrollmentFinalized">
    <span class="finalized-icon">üîí</span>
    <div class="finalized-info">
      <strong>Inscripci√≥n FINALIZADA</strong>
      <span class="finalized-date" *ngIf="enrollmentFinalizedAt">
        Finalizada el {{ formatDateTime(enrollmentFinalizedAt) }}
      </span>
      <span class="finalized-note">Ya no puedes modificar tu inscripci√≥n</span>
    </div>
  </div>

  <!-- Enrollment Period Status Banner -->
  <div class="period-banner" [class.open]="enrollmentPeriodOpen && !enrollmentFinalized" [class.closed]="!enrollmentPeriodOpen || enrollmentFinalized" *ngIf="!enrollmentFinalized">
    <div class="period-status">
      <span class="status-icon">{{ enrollmentPeriodOpen ? '‚úì' : '‚úó' }}</span>
      <div class="period-info">
        <strong>{{ enrollmentPeriodOpen ? 'Per√≠odo de inscripci√≥n ABIERTO' : 'Per√≠odo de inscripci√≥n CERRADO' }}</strong>
        <div class="period-details" *ngIf="period">
          <span class="period-name">üìÖ {{ period.name }} ({{ period.semester_year }})</span>
          <div class="period-dates">
            <div class="date-item">
              <span class="date-label">Desde:</span>
              <span class="date-value">{{ formatDateTime(period.start_date) }}</span>
            </div>
            <div class="date-item">
              <span class="date-label">Hasta:</span>
              <span class="date-value">{{ formatDateTime(period.end_date) }}</span>
            </div>
          </div>
        </div>
        <span *ngIf="!period && !enrollmentPeriodOpen" class="no-period">No hay per√≠odo de inscripci√≥n activo actualmente</span>
      </div>
    </div>
  </div>

  <div class="alert alert-success" *ngIf="success">{{ success }}</div>
  <div class="alert alert-danger" *ngIf="error">{{ error }}</div>

  <div class="loading" *ngIf="loading">Cargando ofertas...</div>

  <div class="offerings-grid" *ngIf="!loading">
    <div class="offering-card" *ngFor="let o of offerings" [class.disabled]="!o.can_enroll || !canModifyEnrollment">
      <div class="offering-header">
        <span class="subject-code">{{ o.subject?.code }}</span>
        <span class="quota-badge" [class.full]="o.available_quota === 0">
          {{ o.enrolled_count }}/{{ o.max_quota }}
        </span>
      </div>

      <h3 class="subject-name">{{ o.subject?.name }}</h3>

      <div class="offering-details">
        <div class="detail-row">
          <span class="label">Docente:</span>
          <span>{{ o.teacher?.user?.username || '-' }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Aula:</span>
          <span>{{ o.classroom?.code }} ({{ o.classroom?.building }})</span>
        </div>
        <div class="detail-row">
          <span class="label">Horario:</span>
          <span class="schedule">{{ formatSchedule(o.schedule) }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Disponibles:</span>
          <span [class.text-success]="o.available_quota > 0" [class.text-danger]="o.available_quota === 0">
            {{ o.available_quota }} plazas
          </span>
        </div>
      </div>

      <div class="restrictions" *ngIf="o.restrictions && o.restrictions.length">
        <span class="restriction-tag" *ngFor="let r of o.restrictions">{{ r }}</span>
      </div>

      <button 
        class="btn btn-primary btn-block" 
        [disabled]="!o.can_enroll || !canModifyEnrollment || enrolling === o.id"
        (click)="enroll(o)">
        <ng-container *ngIf="enrollmentFinalized">Inscripci√≥n finalizada</ng-container>
        <ng-container *ngIf="!enrollmentFinalized && !enrollmentPeriodOpen">Per√≠odo cerrado</ng-container>
        <ng-container *ngIf="canModifyEnrollment">
          {{ enrolling === o.id ? 'Inscribiendo...' : (o.can_enroll ? 'Inscribirse' : 'No disponible') }}
        </ng-container>
      </button>
    </div>
  </div>

  <div class="empty" *ngIf="!loading && !offerings.length">
    <p>No hay ofertas disponibles en este momento</p>
  </div>
</div>
