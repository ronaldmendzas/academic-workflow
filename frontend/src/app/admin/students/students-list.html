<div class="admin-page">
  <div class="page-header">
    <div>
      <h1>Students</h1>
      <p class="text-muted">Manage student records</p>
    </div>
    <button class="btn btn-primary" (click)="openCreate()">+ Add Student</button>
  </div>

  <div class="alert alert-success" *ngIf="success">{{ success }}</div>
  <div class="alert alert-danger" *ngIf="error && !showModal">{{ error }}</div>

  <div class="card">
    <div class="loading" *ngIf="loading">Loading...</div>
    <table class="table" *ngIf="!loading && students.length">
      <thead>
        <tr>
          <th>Code</th>
          <th>Email</th>
          <th>Career</th>
          <th>Semester</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let s of students">
          <td><code>{{ s.code }}</code></td>
          <td>{{ s.user?.email }}</td>
          <td>{{ s.career }}</td>
          <td>{{ s.semester }}</td>
          <td><span class="badge" [class.badge-success]="s.academic_status === 'active'" [class.badge-muted]="s.academic_status !== 'active'">{{ s.academic_status }}</span></td>
          <td class="actions">
            <button class="btn btn-sm btn-ghost" (click)="openEdit(s)">Edit</button>
            <button class="btn btn-sm btn-ghost btn-danger" (click)="delete(s)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="empty" *ngIf="!loading && !students.length">
      <p>No students found</p>
      <button class="btn btn-primary" (click)="openCreate()">Add your first student</button>
    </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ editing ? 'Edit' : 'New' }} Student</h2>
      <button class="btn-close" (click)="closeModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="alert alert-danger" *ngIf="error">{{ error }}</div>
      <div class="form-row" *ngIf="editing">
        <div class="form-group full-width"><label>Code (auto-generated)</label><input type="text" [(ngModel)]="form.code" disabled></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Username *</label><input type="text" [(ngModel)]="form.username" [disabled]="editing" required></div>
        <div class="form-group"><label>Email *</label><input type="email" [(ngModel)]="form.email" required></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Career *</label><input type="text" [(ngModel)]="form.career" required></div>
        <div class="form-group"><label>Password {{ editing ? '' : '*' }}</label><input type="password" [(ngModel)]="form.password" [required]="!editing"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Semester</label><input type="number" [(ngModel)]="form.semester" min="1" max="12"></div>
        <div class="form-group"><label>Max Subjects</label><input type="number" [(ngModel)]="form.max_subjects" min="1"></div>
      </div>
      <div class="form-group">
        <label>Status</label><select [(ngModel)]="form.academic_status"><option value="active">Active</option><option value="probation">Probation</option><option value="suspended">Suspended</option><option value="graduated">Graduated</option></select>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" (click)="closeModal()">Cancel</button>
      <button class="btn btn-primary" (click)="save()">{{ editing ? 'Update' : 'Create' }}</button>
    </div>
  </div>
</div>
